# Kickstart file automatically generated by anaconda.

#version=DEVEL
install
cdrom
text
lang en_US.UTF-8
keyboard us
network --onboot yes --device eth0 --bootproto dhcp --noipv6
rootpw --plaintext temp
firewall --service=ssh
authconfig --enableshadow --passalgo=sha512
selinux --disabled
timezone --utc America/New_York
bootloader --location=mbr --driveorder=sda --append="crashkernel=auto rhgb quiet"

# The following is the partition information you requested
# Note that any partitions you deleted are not expressed
# here so unless you clear all partitions first, this is
# not guaranteed to work

# Clean out the old disk config
zerombr
 
# Clean out old partitions
clearpart --all --drives=sda
 
# Make a new partition for the volgroup
part pv.008002 --size=39000 --ondisk=sda
 
# Make the volgroup
volgroup VolGroup --pesize=4096 pv.008002
 
# Make / on the volgroup
logvol / --fstype=ext4 --name=lv_root --vgname=VolGroup --grow --size=10#-# 24 --maxsize=37000

# Setup swap on the volgroup
logvol swap --name=lv_swap --vgname=VolGroup --grow --size=2016 --maxsize=2016

# Setup the boot partition on the volgroup
part /boot --fstype=ext4 --size=500

# Location of the package data
url --url http://mirrors.seas.harvard.edu/centos/6/os/x86_64/
# repo --name="CentOS" --baseurl=cdrom:sr1 --cost=100 # "Anaconda already have a valid repo for CD/DVD based installations"
repo --name="EPEL" --baseurl=http://download.fedoraproject.org/pub/epel/6/x86_64
repo --name=updates --baseurl=http://mirrors.seas.harvard.edu/centos/6/updates/x86_64/


%packages --nobase
	@core

	# For the virtualbox additions
	kernel-devel
	kernel-headers  
	make 
	dkms
	bzip2
	openssh-clients
	nano
	htop

	# required to build ruby
	# should be kept for gems that build native extensions.
	wget
	automake
	gcc
	cpp
	glibc-devel
	glibc-headers
	glibc-kernheaders
	glibc
	glibc-common
	libgcc

	# required to build ruby bindings, can be removed after
	zlib-devel
	openssl-devel
	readline-devel
%end

%post

	# Change to a vt to see progress

	exec < /dev/tty3 > /dev/tty3
	chvt 3

	# redirect output to ks-post.log including stdout and stderr
	(
#-# 		#######################################################
#-# 		# Build Ruby
#-# 		#######################################################
#-# 
#-# 		# Keep it clean
#-# 		mkdir /tmp/ruby
#-# 		cd /tmp/ruby
#-# 
#-# 		# autoconf 2.60 is required to build ruby
#-# 		wget http://ftp.gnu.org/gnu/autoconf/autoconf-2.60.tar.gz
#-# 		tar -xzf autoconf-2.60.tar.gz
#-# 		cd autoconf-2.60
#-# 		./configure --prefix=/usr && make && make install
#-# 		cd /tmp/ruby
#-# 
#-# 		# build ruby-1.8.7-p358
#-# 		wget http://ftp.ruby-lang.org/pub/ruby/1.8/ruby-1.8.7-p358.tar.bz2
#-# 		tar -xjf ruby-1.8.7-p358.tar.bz2
#-# 		cd ruby-1.8.7-p358
#-# 		autoconf
#-# 		./configure --prefix=/usr && make && make install
#-# 		cd /tmp/ruby
#-# 
#-# 		# install ruby-gems 1.8.10
#-# 		wget http://production.cf.rubygems.org/rubygems/rubygems-1.8.10.tgz
#-# 		tar -xzf rubygems-1.8.10.tgz
#-# 		cd rubygems-1.8.10
#-# 		/usr/bin/ruby setup.rb
#-# 
#-# 		# clean up
#-# 		cd /
#-# 		rm -rf /tmp/ruby

#-# 		#######################################################
#-# 		# Install Puppet
#-# 		#######################################################
#-# 		gem install puppet --no-rdoc --no-ri
#-# 
#-# 		# add the puppet group
#-# 		groupadd puppet

		#######################################################
		# Turn off un-needed services
		#######################################################
		chkconfig sendmail off
		chkconfig vbox-add-x11 off
		chkconfig smartd off
		chkconfig ntpd off
		chkconfig cupsd off

		#######################################################
		# Setup my user: bhyde/temp
                #     fyi:  perl -e'print crypt("temp", "zz"), "\n"'
		#######################################################
		groupadd admin
		useradd -g admin -p 'zz74jcBJeB/fM' bhyde

		# Add ssh pubkey for key auth
		# Make your own if this is private.
		mkdir /home/bhyde/.ssh
		echo "ssh-dss AAAAB3NzaC1kc3MAAAEBAPhkdcWvr8TG/rwAgiyc+h4KTgH2H7CJuJDUOsky+f8b7Dl9iGYGfatsjqeCrfoSzImfl6NEcmMh3/HWSCg1cdfFNzgb6AcFZcD8ghIimV75N2PKyIYo6YyIhGTVo8xE8uOyzHI2b8jk5YUJikIKyigOGjgWO35/oCBQuPXxi7HPx8P5AqSJtdvFS77fr/TczdNmEX9V141FwFLl2V6hfkIH8waOKbwyAX5xO21v+S+4khNmWvMfWF84ll7BBmVPRndio3hfAtsw/72hJqJVMXXZd57nsR1kVMxeiOHJUvJoT/yqlAVMkiKegt45VMvmD7LgqJKxVNHZAD5LAyZpPJ8AAAAVAPUyvvFqCWA4Hrh+Ckrxjc7jpBjJAAABACai5oUigP35SbqrzF+0ygMBCSoGKFSeF8DGmFczDdKRUGA74Oo+bck3Nuurh42F/9oaNm5qiv+YSCRC+uNzwNMijARttXNH7+iWWAJgwwt92iSE6nWNq2qk2zFzl96Ucl5dZ+QGgugUqPNiXuHH4w4wkVxYoAmlxCmWrD5sfLVmqKcpMgJ8EjlWavlObAyfUVzlL5g0pMbsM7K1bcEkFfb1U7wVZqhWyOd/I5JwRDJRNl5YgomZ6IiXiSw+LyDoUqZx4FChc4++WmTn6A+uVQQzvBIE/XxMNFpEJfbdLZtFfLvlrttXR3sBrNUgrmyMvcejhQeFPm1EO208rNAA4fMAAAEAblHpfp5hiubQ6UypJNU9o5e4xCbOr66y3oiK3rTdbH0XKjBR90N6Nbd0a0oz0/mmGc2aXDFpEiDOWEYaJiMupji52f32xsXvWmxN9MxAA/P3zbReoGmwAQQHEvxzHrKZ9GY3ROwoqbW2Xs23LnOpC6Y63+oMl8N3abmhvFAUi4L79RNf0n21GkvTgzIVR2OHFIkNIHcSgN6tS38+AhBXwU6UBFH1a6QmJMzHn8mZ/e6PI23L7+sdQGjlzu+Yv2oLQsQBGi88BIsUtHGxLnOGUgPK9Vo/TMH0F3SiJdkpTcL76LUMDtTfrfluQRS9G+Gcvwxu34DOmdOXn4QPHVaPZQ== bhyde@pobox.com" > /home/bhyde/.ssh/authorized_keys

		#######################################################
		# Establish a useful sudoers
		#######################################################
		echo 'Defaults env_keep="SSH_AUTH_SOCK"' >> /etc/sudoers
		echo '%admin    ALL=NOPASSWD: ALL' >> /etc/sudoers


		########################################################
		# Cleanup for compression
		#######################################################
		# Remove ruby build libs
		yum -y remove zlib-devel openssl-devel readline-devel
		
		# Cleanup other files we do not need
		yum -y groupremove "Dialup Networking Support" Editors "Printing Support" "Additional Development" "E-mail server"


	) 2>&1 | /usr/bin/tee /root/ks-post.log

	# switch back to gui
	chvt 7

%end

reboot
